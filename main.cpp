// https://habrahabr.ru/post/161073/
//Переводчик иностранных слов, использующий словари StarDict
//
// Про StarDict  можно писать долго, но основное преимущество этого формата то, 
// что для него есть очень много словарных баз, практически на всех языках. 
// Файл, описывающий формат StarDict, обычно расположен рядом с самими исходниками.
// Если отбросить все дополнения, то самый минимальный набор знаний по этому формату будет следующим:
// Каждый словарь должен содержать в себе 3 обязательных файла:
//
// 1. Файл с расширением ifo  — содержит непротиворечивое описание самого словаря;
// 2. Файл с расширением idx . Каждая запись внутри idx файла состоит из 3-х полей, идущих друг за другом:
//     word_str — Строка в формате utf-8, заканчивающаяся '\0';
//     word_data_offset - Смещение до записи в файле .dict (размер числа 32 или 64 бита);
//     word_data_size — Размер всей записи в файле .dict.
//
// 3. Файл с расширением dict — содержит сами переводы, 
//    добраться до которых можно зная смещение до перевода (смещение записано в файле idx).
//...........................................................................................

// Код сделан под смещение и размер записи quint32 (32 бита). Если менять, то смотреть,
// где используются QHash <QString, QPair <quint32, quint32> > mHash (в паре первым идёт
// смещение, вторым - размер перевода) и quint32 offset, quint32 size.
// Также quint32: wordcount (количество слов в словаре), и idxfilesize (размер файла .idx)

// void Dictionarys::setNameFiles() формирует рабочие имена файлов словаря из назавания папки с этими файлами
// Название папки обрезается по направление перевода: в частности, ER или RE (задаётся глобальной переменной tr),
// и отбрасывается версия словаря (за последним '-'). Проверить, чтобы совпадало с реальными именами файлов.
// пример: папка "stardict-lingvo-ER-Computer-2.4.2"; файлы: ER-Computer.dict, ER-Computer.ifo, ER-Computer.idx
	 
#include <QtGui>
#include "dictionarys.h"
#include <QtGui/QApplication>

#ifdef QT_DEBUG
#include <vld.h>
#include <Windows.h>
#endif

int main(int argc, char *argv[])
{
#ifdef QT_DEBUG
	SetConsoleCP(1251);
	SetConsoleOutputCP(1251);
#endif
	
	QApplication app(argc, argv);

	QTextCodec::setCodecForTr(QTextCodec::codecForName("CP1251"));

	Dictionarys w;
	
	QObject::connect(&w, SIGNAL(destroyed()), &app, SLOT(quit()));
	
	w.show();
	return app.exec();
}
